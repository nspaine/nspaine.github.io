<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>personal-website</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&display=block" rel="stylesheet">
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #050505;
      overflow: hidden;
    }

    @keyframes squareWave {
      0% {
        transform: translateX(0);
      }

      100% {
        transform: translateX(-50%);
      }
    }

    .loader-wave {
      animation: squareWave 2s linear infinite;
    }
  </style>
</head>

<body>
  <!-- Critical Loading Screen (Outside #root to survive hydration) -->

  <div id="initial-loader"
    style="position: fixed; inset: 0; background-color: #050505; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 1.5rem; z-index: 99999; transition: opacity 0.5s ease-out;">

    <!-- Home Loader Content -->
    <div id="loader-home" style="display: none; flex-direction: column; align-items: center; gap: 1.5rem;">
      <div style="width: 16rem; height: 8rem; overflow: hidden; position: relative;">
        <svg class="loader-wave" viewBox="0 0 400 100" preserveAspectRatio="none"
          style="width: 200%; height: 100%; display: block;">
          <path
            d="M0,80 L0,20 L50,20 L50,80 L100,80 L100,20 L150,20 L150,80 L200,80 L200,20 L250,20 L250,80 L300,80 L300,20 L350,20 L350,80 L400,80"
            fill="none" stroke="#FFD700" stroke-width="3" stroke-linecap="square"
            style="filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.6));" />
        </svg>
      </div>
      <p
        style="color: #FFD700; font-size: 0.875rem; letter-spacing: 0.3em; font-family: 'Orbitron', monospace; font-weight: 700; text-transform: uppercase; margin: 0;">
        ANALYZING SIGNALS...
      </p>
    </div>

    <!-- Portfolio Loader Content -->
    <div id="loader-portfolio"
      style="display: none; align-items: center; justify-content: center; width: 100%; height: 100%;">
      <canvas id="binary-canvas"
        style="position: absolute; inset: 0; width: 100%; height: 100%; opacity: 0.8;"></canvas>
      <div
        style="position: relative; z-index: 10; display: flex; flex-direction: column; align-items: center; gap: 1rem;">
        <p
          style="color: #FFD700; font-size: 0.875rem; letter-spacing: 0.2em; font-family: 'Orbitron', monospace; font-weight: 700; text-transform: uppercase; margin: 0; animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;">
          DOWNLOADING BYTES...
        </p>
      </div>
      <style>
        @keyframes pulse {

          0%,
          100% {
            opacity: 1;
          }

          50% {
            opacity: 0.5;
          }
        }
      </style>
    </div>

    <!-- Router Logic for Initial Loader -->
    <script>
      (function () {
        const homeLoader = document.getElementById('loader-home');
        const portfolioLoader = document.getElementById('loader-portfolio');

        if (window.location.pathname.includes('/portfolio')) {
          portfolioLoader.style.display = 'flex';

          const canvas = document.getElementById('binary-canvas');

          // --- INLINE WORKER FOR ZERO BOOT LAG ---
          // Runs the animation off-main-thread while React hydrates
          if (canvas.transferControlToOffscreen) {
            const offscreen = canvas.transferControlToOffscreen();

            const workerCode = `
              let ctx;
              let width, height;
              let columns;
              let drops;
              let fontSize = 14;

              self.onmessage = function(e) {
                const { type, payload } = e.data;
                if (type === 'INIT') {
                  const canvas = payload.canvas;
                  ctx = canvas.getContext('2d');
                  width = payload.width;
                  height = payload.height;
                  resize();
                  loop();
                } else if (type === 'RESIZE') {
                  width = payload.width;
                  height = payload.height;
                  resize();
                }
              };

              function resize() {
                if(!width) return;
                // Fix: Update internal canvas buffer size!
                const canvas = ctx.canvas;
                canvas.width = width;
                canvas.height = height;

                // Re-calc columns
                columns = Math.ceil(width / fontSize);
                if(!drops || drops.length !== columns) {
                   drops = Array(columns).fill(1).map(() => Math.random() * -100);
                }
              }

              function loop() {
                ctx.fillStyle = 'rgba(5, 5, 5, 0.1)';
                ctx.fillRect(0, 0, width, height);
                ctx.fillStyle = '#FFD700';
                ctx.font = fontSize + "px 'Courier New', monospace";

                for (let i = 0; i < drops.length; i++) {
                  const text = Math.random() > 0.5 ? '1' : '0';
                  ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                  if (drops[i] * fontSize > height && Math.random() > 0.975) {
                    drops[i] = 0;
                  }
                  drops[i]++;
                }
                requestAnimationFrame(loop);
              }
            `;

            const blob = new Blob([workerCode], { type: 'application/javascript' });
            const worker = new Worker(URL.createObjectURL(blob));

            worker.postMessage({
              type: 'INIT',
              payload: {
                canvas: offscreen,
                width: window.innerWidth,
                height: window.innerHeight
              }
            }, [offscreen]);

            window.addEventListener('resize', () => {
              worker.postMessage({
                type: 'RESIZE',
                payload: { width: window.innerWidth, height: window.innerHeight }
              });
            });

          } else {
            // Fallback for Safari/Legacy (Main Thread)
            const ctx = canvas.getContext('2d');
            const resize = () => {
              canvas.width = window.innerWidth;
              canvas.height = window.innerHeight;
            };
            window.addEventListener('resize', resize);
            resize();

            const fontSize = 14;
            let columns = Math.ceil(canvas.width / fontSize);
            let drops = Array(columns).fill(1).map(() => Math.random() * -100);

            function draw() {
              ctx.fillStyle = 'rgba(5, 5, 5, 0.1)';
              ctx.fillRect(0, 0, canvas.width, canvas.height);
              ctx.fillStyle = '#FFD700';
              ctx.font = fontSize + "px 'Courier New', monospace";

              for (let i = 0; i < drops.length; i++) {
                const text = Math.random() > 0.5 ? '1' : '0';
                ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                  drops[i] = 0;
                }
                drops[i]++;
              }
              requestAnimationFrame(draw);
            }
            draw();
          }

        } else {
          homeLoader.style.display = 'flex';
        }
      })();
    </script>
  </div>

  <div id="root"></div>
  <script type="module" src="/src/main.jsx"></script>
</body>

</html>